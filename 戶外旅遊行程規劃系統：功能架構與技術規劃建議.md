# 戶外旅遊行程規劃系統：功能架構與技術規劃建議

## 1. 前言

本文件旨在分析您現有的「Outdoor Trip Planner」專案，並基於目前的基礎，提出一套更完整、更具擴展性的功能性架構。這套架構將涵蓋從行程規劃、團隊協作、裝備管理到第三方服務整合等多個面向，希望能為您提供一個清晰的開發藍圖，打造出一個功能強大且使用者體驗卓越的旅遊行程規劃平台。

## 2. 現有系統分析

在深入探討新架構之前，我們首先對您目前的系統進行了分析。目前的版本已經具備了幾個核心功能，為後續的開發奠定了良好的基礎。

### 2.1. 已實現功能

| 功能模組 | 內容 | 備註 |
| :--- | :--- | :--- |
| **行程規劃 (Itinerary)** | - 支援多天數行程的新增、刪除、複製與拖曳排序<br>- 可編輯每日行程的標題、內容與狀態 (未完成/進行中/已完成)<br>- 支援圖片上傳 (但目前似乎僅為 UI 佔位) | 使用 `dnd-kit` 實現拖曳排序，體驗流暢。 |
| **裝備檢查表 (Gear Checklist)** | - 可從預設範本 (一日郊山、百岳重裝、休閒露營) 快速匯入裝備<br>- 裝備清單以分類方式呈現<br>- 可勾選已準備的裝備，並計算準備進度百分比 | 範本化的設計能有效提升使用者效率。 |
| **權限管理 (Access Control)** | - 透過密碼區分三種角色：管理員 (admin)、參加者 (team)、訪客 (viewer)<br>- 特定資訊 (如預算、保險) 僅對管理員與參加者顯示 | 這是實現團隊協作與隱私保護的關鍵第一步。 |
| **資料持久化 (Data Persistence)** | - 使用 Firebase Firestore 作為後端資料庫<br>- 行程與裝備清單的變更可以儲存至雲端 | 確保了使用者資料不會因關閉瀏覽器而遺失。 |

### 2.2. 技術棧評估

目前的技術選型相當現代化，為專案的未來發展提供了良好的基礎：

- **前端框架**: React + Vite，提供了高效的開發體驗與優異的執行效能。
- **UI 元件庫**: `lucide-react` 提供了一致且美觀的圖示。
- **後端服務**: Firebase Firestore，作為一個 NoSQL、即時同步的資料庫，非常適合此類協作型應用。
- **部署**: 使用 GitHub Pages 進行靜態網站部署，簡單快速。

### 2.3. 待改進與可擴展之處

- **地圖功能**: Google Maps API Key 未設定，導致地圖無法正常載入。這是目前最明顯的錯誤。
- **系統設定**: 「系統設定」頁面目前沒有實際功能，點擊後無反應。
- **AI 整合**: 目前的 AI 雨天備案功能 (`ai.js`) 僅為模擬，尚未與真實的語言模型 (如 Gemini) 對接。
- **UI/UX**: 部分操作（如儲存）後僅有 `alert` 提示，使用者體驗有待提升。圖片上傳與顯示功能尚未完全實現。
- **資料模型**: 目前的 Firestore 資料模型較為單純，所有資訊都儲存在單一的 `trips` 集合中。隨著功能增加，可能需要更精細的資料結構設計。

## 3. 完整功能性架構規劃

基於現有基礎，我們規劃了一套更全面的功能架構，旨在將您的專案從一個個人工具提升為一個功能完善的協作平台。此架構分為核心功能、協作功能、智慧化功能與擴展功能四個層次。

### 3.1. 核心功能 (Core Features)

這是構成一個行程規劃工具最基礎、不可或缺的部分。

| 功能模組 | 詳細說明 | 技術建議 |
| :--- | :--- | :--- |
| **行程儀表板 (Dashboard)** | - 集中展示使用者所有參與或建立的行程<br>- 提供快速建立新行程的入口<br>- 顯示行程狀態 (規劃中、進行中、已結束) | - 新增 `User` 集合，並在 `Trip` 文件中記錄參與者 ID<br>- 透過 Firestore 查詢實現 |
| **進階行程編輯器** | - **時間軸視圖**: 除了每日行程，增加更細緻的時間點規劃 (e.g., 09:00 集合, 10:30 抵達登山口)<br>- **地點/POI 整合**: 每個時間點可關聯一個具體地點 (POI)，並在地圖上標示<br>- **交通方式**: 規劃點與點之間的交通方式與預估時間 | - 在 `itinerary` 的 `day` 物件中增加 `events` 陣列<br>- 整合 Google Places API 進行地點搜尋與自動完成 |
| **互動式地圖 (Interactive Map)** | - **路線繪製**: 在地圖上繪製每日的完整路線 (Polyline)<br>- **POI 標記**: 標示每日行程中的重要地點 (Markers)<br>- **即時位置分享 (選用)**: 團隊成員可選擇分享自己的即時位置 | - 正確設定並使用 `@react-google-maps/api`<br>- 將行程中的地點座標傳遞給地圖元件進行繪製 |
| **預算與花費追蹤** | - 建立預算項目 (如交通、住宿、餐飲)<br>- 團隊成員可共同記錄實際花費<br>- 自動計算總花費與個人分攤金額 | - 在 `Trip` 文件下新增 `budget` 與 `expenses` 子集合<br>- 建立對應的 UI 進行新增與顯示 |

### 3.2. 協作功能 (Collaboration Features)

讓行程規劃從個人活動變成團隊合作。

| 功能模組 | 詳細說明 | 技術建議 |
| :--- | :--- | :--- |
| **團隊管理 (Team Management)** | - 行程創建者可邀請成員加入<br>- 設定不同成員的角色與權限 (管理員、編輯者、成員)<br>- 移除或修改成員權限 | - 擴充現有的密碼系統，改為基於使用者帳號的邀請制<br>- 在 `Trip` 文件中增加 `members` 欄位，儲存成員角色 |
| **留言與討論區** | - 在每個行程日或特定 POI 下方提供留言功能<br>- 團隊成員可以進行討論、提問或發布公告<br>- 支援 `@` 提及特定成員 | - 在 `Day` 或 `POI` 文件下新增 `comments` 子集合<br>- 使用 Firestore 的即時更新特性來顯示新留言 |
| **投票系統 (Voting System)** | - 針對待定事項 (如餐廳、住宿地點) 發起投票<br>- 成員可以對不同選項進行投票<br>- 顯示投票結果，幫助團隊快速達成共識 | - 在 `Trip` 文件下新增 `polls` 子集合<br>- 建立投票元件，並即時更新投票數 |
| **通知中心 (Notification Center)** | - 當行程有重要更新、新留言或被提及時，發送通知給相關成員<br>- 整合 Email 或 App 推播通知 | - 使用 Firebase Cloud Functions 監聽 Firestore 的變更<br>- 整合 Firebase Cloud Messaging (FCM) 或第三方郵件服務 (如 SendGrid) |

### 3.3. 智慧化功能 (Intelligent Features)

利用 AI 與數據分析，讓行程規劃更輕鬆、更聰明。

| 功能模組 | 詳細說明 | 技術建議 |
| :--- | :--- | :--- |
| **AI 行程建議 (AI Itinerary Assistant)** | - 使用者輸入目的地、天數、興趣偏好後，由 AI 自動生成行程草稿<br>- **雨天備案**: 根據即時天氣，動態生成雨天備案 (擴充現有功能)<br>- **裝備建議**: 根據行程地點、季節與活動類型，由 AI 推薦裝備清單 | - 對接 Gemini API<br>- 設計精確的 Prompt，引導模型生成結構化的 JSON 格式行程資料<br>- 整合天氣 API (如 OpenWeatherMap) |
| **地理資訊分析 (Geospatial Analysis)** | - **GPX 匯入/匯出**: 支援匯入山友分享的 GPX 軌跡檔，並在地圖上顯示；也可將規劃好的路線匯出成 GPX<br>- **海拔剖面圖**: 顯示路線的海拔起伏變化<br>- **日出日落時間**: 根據地點與日期，自動顯示日出日落時間 | - 使用 `gpx-parser-builder` 等函式庫處理 GPX 檔案<br>- 呼叫 Google Maps Elevation API 獲取海拔資料<br>- 使用 `suncalc` 等函式庫計算日出日落時間 |
| **公開行程探索 (Public Trip Discovery)** | - 使用者可選擇將自己的行程公開，分享給社群<br>- 建立一個探索頁面，讓使用者可以搜尋、瀏覽他人分享的公開行程<br>- 可複製他人的公開行程作為自己規劃的範本 | - 在 `Trip` 文件中增加 `isPublic` 欄位<br>- 建立 Algolia 或 Firestore 的搜尋索引以實現高效搜尋 |

### 3.4. 擴展功能 (Extended Features)

為平台的長期發展提供更多可能性。

| 功能模組 | 詳細說明 | 技術建議 |
| :--- | :--- | :--- |
| **使用者個人檔案 (User Profile)** | - 建立使用者個人頁面，展示過去的行程、照片牆、成就徽章等<br>- 追蹤個人的戶外活動數據 (如總公里數、爬升高度) | - 擴充 `User` 集合，增加個人化欄位<br>- 在行程結束後，統計相關數據並更新至個人檔案 |
| **離線模式 (Offline Mode)** | - 在沒有網路的戶外環境，依然可以查看行程、地圖與裝備清單<br>- 當網路恢復時，自動同步本地變更 | - 使用 Firebase 的離線資料持久化功能<br>- 考慮使用 Progressive Web App (PWA) 技術，將核心資源快取在裝置上 |
| **第三方整合 (Third-Party Integrations)** | - **住宿預訂**: 整合 Booking.com 或 Agoda API，直接在行程中預訂住宿<br>- **租車服務**: 整合租車平台 API<br>- **行事曆同步**: 將規劃好的行程一鍵同步到 Google Calendar 或 Apple Calendar | - 研究並申請各平台的開發者 API<br>- 使用 OAuth 2.0 進行使用者授權 |

## 4. 結論與下一步建議

您目前的專案已經是一個很好的起點。我們建議您可以依照以下順序，逐步完善您的旅遊行程規劃網站：

1.  **修復現有問題**: 首先，設定好您的 Google Maps API Key，讓地圖功能恢復正常。同時，可以為儲存等操作加上更友善的提示（例如使用 `react-hot-toast` 取代 `alert`）。

2.  **完善核心功能**: 接著，您可以開始著手開發「行程儀表板」與「進階行程編輯器」，這是整個系統的骨幹。

3.  **強化協作體驗**: 完成核心功能後，逐步加入「團隊管理」、「留言討論」等協作功能，讓應用程式從個人工具轉變為團隊平台。

4.  **引入智慧化服務**: 最後，對接真實的 Gemini API 與天氣 API，讓 AI 建議與地理資訊分析成為您產品的亮點。

這份文件提供了一個較為宏觀的架構藍圖。在實際開發過程中，每個功能模組都還需要更詳細的設計。期待這個規劃能幫助您的專案邁向新的高度！
